<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>WebGL Tests</title>
    <style>
      body {
        text-align: center;
      }
    </style>
  </head>
  <body>

    <script id="vshader" type="x-shader">
      attribute vec3 aPosition;
      attribute vec4 aColor;
      attribute vec2 aTexCoord;
      attribute float aRotation;
      attribute vec2 aTPosition;
      attribute vec2 aTOrigin;
      attribute float aTid;
      varying vec4 vColor;
      varying vec2 vTexCoord;
      varying float vTid;
      uniform mat4 uPrMatrix;
      uniform mat4 uVwMatrix;
      uniform mat4 uModelMatrix;

      vec4 QuaternionAroundZ(float angle)
      {
        vec4 result;
        float halfTetha = (angle * 0.5) * 3.14159 / 180.0;
        result.x = 0.0;
        result.y = 0.0;
        result.z = 1.0 * sin(halfTetha);
        result.w = cos(halfTetha);
        return result;
      }

      vec4 QuaternionConjugate(vec4 q)
      {
        return vec4(-q.x, -q.y, -q.z, q.w);
      }

      vec4 QuaternionMultiplication(vec4 lhs, vec4 rhs)
      {
        vec4 result;
        result.x = (lhs.w * rhs.x) + (lhs.x * rhs.w) + (lhs.y * rhs.z) - (lhs.z * rhs.y);
        result.y = (lhs.w * rhs.y) - (lhs.x * rhs.z) + (lhs.y * rhs.w) + (lhs.z * rhs.x);
        result.z = (lhs.w * rhs.z) + (lhs.x * rhs.y) - (lhs.y * rhs.x) + (lhs.z * rhs.w);
        result.w = (lhs.w * rhs.w) - (lhs.x * rhs.x) - (lhs.y * rhs.y) - (lhs.z * rhs.z);
        return result;
      }

      vec3 RotateVector(vec3 position, float angle)
      {
        vec4 quaternion = QuaternionAroundZ(angle);
        vec4 conjugate = QuaternionConjugate(quaternion);
        vec4 quaternionPosition = vec4(position.x, position.y, position.z, 0);

        vec4 temp = QuaternionMultiplication(quaternion, quaternionPosition);
        quaternion = QuaternionMultiplication(temp, conjugate);

        return vec3(quaternion.x, quaternion.y, quaternion.z);
      }

      void main(){
        vec3 rotated = RotateVector(vec3(aPosition.xy - aTOrigin,aPosition.z), aRotation);
        rotated.xy += aTOrigin;
        rotated += vec3(aTPosition,0);
        vColor = aColor;
        vTid = aTid;
        vTexCoord = aTexCoord;
        gl_Position = uPrMatrix * uVwMatrix * uModelMatrix * vec4(rotated,1.0);
      }
    </script>
    <script id="fshader" type="x-shader">
    precision mediump float;
    varying float vTid;
    varying vec4 vColor;
    varying vec2 vTexCoord;
    uniform bool useTexturing;
    uniform sampler2D uSampler;
    void main(){
      vec4 c = vec4(1.0,1.0,1.0,1.0);
      if(useTexturing){
       c = texture2D(uSampler,vTexCoord);
      }
      gl_FragColor = vColor * c;
    }

    </script>
    <p>For now everthing is in a different file, later on we can combine them.</p>
    <canvas id="webgl-canvas" width="1024" height="768">
      Oops ... your browser is from the stone age... Please update...
    </canvas>
    <script src="graphics/texture.js" charset="utf-8"></script>
    <script src="graphics/sprite.js" charset="utf-8"></script>
    <script src="graphics/shaderProgram.js" charset="utf-8"></script>
    <script src="graphics/spriteBatch.js" charset="utf-8"></script>
    <script src="graphics/spriteBatchFast.js" charset="utf-8"></script>
    <script src="graphics/quad.js" charset="utf-8"></script>
    <script src="graphics/webglUtils.js" charset="utf-8"></script>
    <script src="math/vec2.js" charset="utf-8"></script>
    <script src="math/vec3.js" charset="utf-8"></script>
    <script src="math/rect.js" charset="utf-8"></script>
    <script src="math/mat4.js" charset="utf-8"></script>
    <script src="math/random.js" charset="utf-8"></script>
    <script src="main.js" charset="utf-8"></script>
  </body>
</html>
